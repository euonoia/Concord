import{H as i}from"./html5-qrcode-scanner-CK0YHsee.js";function b(l=1){const n=document.getElementById("start-btn"),r=document.getElementById("scan-line"),a=document.getElementById("feedback");if(!n)return;let o,c=null;n.addEventListener("click",async()=>{n.style.display="none",r?.classList.remove("hidden"),o=new i("reader");try{const t=await i.getCameras();if(!t||t.length===0)throw new Error("No camera devices found.");const s=t.find(e=>e.label.toLowerCase().includes("back")||e.label.toLowerCase().includes("rear"));c=s?s.id:t[0].id,await o.start(c,{fps:15,qrbox:{width:250,height:250},aspectRatio:1},async e=>{await o.stop(),r?.classList.add("hidden"),m(e,l)})}catch(t){console.error(t),alert(`Camera access failed. Make sure:

• You are using HTTPS
• Camera permissions are allowed
• No other app is using the camera`),n.style.display="block",r?.classList.add("hidden")}});async function m(t,s){a?.classList.remove("hidden"),a.className="p-4 rounded-2xl mb-6 text-sm font-bold bg-blue-50 text-blue-700",a.innerText="Verifying Attendance...";try{const e=await fetch(`/attendance/verify/${s}`,{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({qr_code:t})}),d=await e.json();if(!e.ok||!d.success)throw new Error(d.message||"Failed to log attendance.");a.className="p-4 rounded-2xl mb-6 text-sm font-bold bg-emerald-50 text-emerald-700",a.innerText="Success! Attendance Recorded.",setTimeout(()=>{window.location.href="/dashboard"},2e3)}catch(e){a.className="p-4 rounded-2xl mb-6 text-sm font-bold bg-red-50 text-red-700",a.innerText=e.message,n.style.display="block"}}}export{b as initQrScanner};
